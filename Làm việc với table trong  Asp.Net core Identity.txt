

AspNetUsers và việc quản lí  User trực tiếp  (tạo/sửa/xóa User)  thuộc  về UserManager<AppUserModel> _userManager  

AspNetUserRoles và việc quản lí User-Role (Tạo ,  xóa) thuộc về  UserManager<AppUserModel> _userManager

AspNetRoles và việc quản lý role trực tiếp (tạo/sửa/xóa role) thuộc về RoleManager<IdentityRole>  _roleManager

SignInManager<AppUserModel> _signInManager làm việc chính với bảng AspNetUser dùng để xác thực Login và  Logout



    public class AppUserModel : IdentityUser {
     
    }
}
 *** AspNetUsers:
+dùng để Create, Update  , Delete  thì  _userManager.Create () ,  _userManager.Remove ()  ,   __userManager.Update(),
Cập nhật lại PasswordHash của AppUserModel trong AspNetUsers :

 _userManage.RemovePasswordAsync(checkEmail); // var checkEmail là user của bảng AspNetUser được tìm kiếm theo Email và  xóa Password của checkEmail
 _userManage.AddPasswordAsync(checkEmail, password); // gán password vào đối tượng checkEmail lúc này password sẽ được mã hóa từ abc@123 thành
AQAAAl9f0qiBBjQlJ0+0Iyw==
 _userManage.UpdateAsync(checkEmail);  //cập nhật lại


  
+dùng Read cả  Table  _userManager.Users   dùng Read 1 phần từ trong Table _userManager.FindByIdAsync() or _userManager.FindByEmailAsync()
+Nếu xóa 1 bản ghi AspNetUser thì nó sẽ cũng tự động xóa bảng ghi AspNetUserRoles thông qua khóa chính và khóa ngoại      



*** AspNetRoles:
+dùng để Create, Update  , Delete  thì  _roleManager.Create () ,  _roleManager.Remove ()  ,   _roleManager.Update()  
+dùng Read cả  Table  _roleManager.Roles  dùng Read 1 phần từ trong Table _roleManager.FindByIdAsync()
+ Nếu xóa 1 bản ghi AspNetRoles thì nó sẽ cũng tự động xóa bảng ghi AspNetUserRoles thông qua khóa chính và khóa ngoại      

 


*** AspNetUserRoles
  
+  cấu trúc  public virtual Task<IdentityResult> AddToRoleAsync(TUser user (1 bản ghi của table AspNetUsers), string roleName (cột của table AspNetRoles))
+ cấu trúc  public virtual Task<IdentityResult> RemoveFromRoleAsync(TUser user (1 bản ghi của table AspNetUsers), string roleName (cột của table AspNetRoles))

   var createUser  //  user của bảng AspNetUser  và  var createRole   // roles của bảng AspNetRoles  
+  dùng để Create  : var addToRoleResult  =   await  _userManager.AddToRoleAsync(createUser, createRole.Name);
+ dùng Remove   :   var removeToRoleResult  = await _userManager.RemoveFromRoleAsync(createUser, createRole.Name);

+  Table  AspNetUserRoles   [UserId  , RoleId]   = (UserId = createUser(tự động lấy ra createUser.Id), RoleId = <Id của createRole có Name=createRole.Name>)

+ Kiểm tra xem addToRoleResult đó đã có bản ghi đó chưa (dựa trên AspNetUserRoles) ,Nếu chưa có → thêm 1 bản  mới vào bảng AspNetUserRoles , Nếu đã có rồi → không thêm nữa và trả về kết quả “addToRoleResult.Succeeded ==  True” (không lỗi).



Note :  Mỗi Models muốn Mapping và trở thành Table của Db  thì bỏ vào trong DbContext nhưng   IdentityUser Mapping vs Db và ứng với Table AspNetUsers thì không cần cỏ vào DbContext      


      - Không  cần SaveChange()  khi  dùng CRUD cho AspNetUsers ,  AspNetRoles ,AspNetUserRoles
--------------------------------------------------------------------------------------------------------------------------------------------------

          IQueryable<T>  or IEnumerable<T>    <==>  List <T>  
  
         Note  : DbSet<T> Users     <=>   IQueryable<T>.
            

          UserManager<T> _userManager  ,   _userManager.Users  <=>   IQueryable<T>....
         Ex :  UserManager<AppUserModel> _userManager    ,   _userManager.Users    <=>    IQueryable<AppUserModel>
    
          T phải là Class kế thừa từ  IdentityUser  






Tóm lại :  DataContext sử dụng  cho  các  Table  không  phải là AspNet core Identity còn các Table là AspNet core Identity sử dụng _userManager , _roleManager

         DataContext dùng cho cả hai khi Query Table ,  Include chỉ dùng cho Class trong Models có  Navigation 





